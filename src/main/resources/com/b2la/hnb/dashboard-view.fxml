<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>
<?import org.kordamp.ikonli.javafx.*?>

<?import javafx.util.Callback?>
<?import javafx.scene.control.cell.PropertyValueFactory?>
<BorderPane prefHeight="400.0" prefWidth="1200.0" stylesheets="@styles.css" xmlns="http://javafx.com/javafx/17.0.12" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.b2la.hnb.controllers.DashboardController">
    <!-- Top Header -->
    <top>
        <HBox alignment="CENTER_LEFT" spacing="20" styleClass="header">
            <ImageView fitHeight="30.0" fitWidth="30.0" pickOnBounds="true" preserveRatio="true">
                <image>
                    <Image url="@images/logo.png" />
                </image>
            </ImageView>
            <Label styleClass="header-title" text="HNB Pâtisserie" />
            <Region HBox.hgrow="ALWAYS" />
            <HBox alignment="CENTER_RIGHT" spacing="10">
                <Label fx:id="dateHeure" styleClass="user-label" text="date/time" />
                <Button styleClass="icon-button">
                    <graphic>
                        <FontIcon iconColor="white" iconLiteral="fa-bell" iconSize="20" />
                    </graphic>
                </Button>
            </HBox>
        </HBox>
    </top>

    <!-- Sidebar -->
    <left>
        <VBox spacing="15" styleClass="sidebar">
            <VBox alignment="CENTER" styleClass="user-profile">
                <FontIcon iconLiteral="fa-user-circle" iconSize="48" styleClass="profile-icon" />
                <Label fx:id="username" styleClass="profile-name" text="user" />
                <Label fx:id="fonction" styleClass="profile-role" text="Administrateur" />
            </VBox>

            <Separator styleClass="divider" />

            <VBox spacing="5" styleClass="menu-container">
                <Button fx:id="home" graphicTextGap="15" onAction="#homeView" styleClass="menu-button active" text="Tableau de bord">
                    <graphic>
                        <FontIcon iconLiteral="fa-tachometer" iconSize="16" />
                    </graphic>
                </Button>
                <Button fx:id="facturation" graphicTextGap="15" onAction="#factureView" styleClass="menu-button" text="Facturation">
                    <graphic>
                        <FontIcon iconColor="#c3bcbc" iconLiteral="fa-file-text" iconSize="16" styleClass="icon-color" />
                    </graphic>
                </Button>
                <Button fx:id="produit" graphicTextGap="15" onAction="#produitView" styleClass="menu-button" text="Produits">
                    <graphic>
                        <FontIcon iconLiteral="fa-glass" iconSize="16" styleClass="icon-color" />
                    </graphic>
                </Button>
                <Button fx:id="depense" graphicTextGap="15" onAction="#depenseView" styleClass="menu-button" text="Depenses">
                    <graphic>
                        <FontIcon iconLiteral="fa-area-chart" iconSize="16" styleClass="icon-color" text="" />
                    </graphic>
                </Button>
                <Button fx:id="cloture" graphicTextGap="15" onAction="#clotureView" styleClass="menu-button" text="Clotures">
                    <graphic>
                        <FontIcon iconLiteral="fa-cart-arrow-down" iconSize="16" styleClass="icon-color" />
                    </graphic>
                </Button>
                <Button fx:id="parametre" graphicTextGap="15" onAction="#parametreView" styleClass="menu-button" text="Paramètres">
                    <graphic>
                        <FontIcon iconLiteral="fa-cog" iconSize="16" styleClass="icon-color" />
                    </graphic>
                </Button>
            </VBox>

            <Region VBox.vgrow="ALWAYS" />

            <Button graphicTextGap="15" styleClass="logout-button" text="Déconnexion">
                <graphic>
                    <FontIcon iconLiteral="fa-sign-out" iconSize="16" />
                </graphic>
            </Button>
        </VBox>
    </left>

    <!-- Main Content -->
    <center>
        <VBox spacing="20" styleClass="content">
            <!-- Stats Cards -->
            <HBox spacing="20" styleClass="stats-row">
                <VBox styleClass="stat-card primary">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <FontIcon iconLiteral="fa-line-chart" iconSize="24" styleClass="stat-icon" />
                        <VBox spacing="5">
                            <Label styleClass="stat-value" text="12,345" />
                            <Label styleClass="stat-label" text="Visiteurs" />
                        </VBox>
                    </HBox>
                    <HBox alignment="CENTER_LEFT" spacing="5">
                        <Label styleClass="stat-trend positive" text="+12%" />
                        <FontIcon iconLiteral="fa-arrow-up" iconSize="12" styleClass="trend-icon" />
                    </HBox>
                </VBox>

                <VBox styleClass="stat-card dark">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <FontIcon iconLiteral="fa-shopping-cart" iconSize="24" styleClass="stat-icon" />
                        <VBox spacing="5">
                            <Label styleClass="stat-value" text="8,642" />
                            <Label styleClass="stat-label" text="Commandes" />
                        </VBox>
                    </HBox>
                    <HBox alignment="CENTER_LEFT" spacing="5">
                        <Label styleClass="stat-trend positive" text="+5%" />
                        <FontIcon iconLiteral="fa-arrow-up" iconSize="12" styleClass="trend-icon" />
                    </HBox>
                </VBox>
            </HBox>
            <StackPane>
                <children>
                    <VBox fx:id="loadingLayout" spacing="10" styleClass="section" visible="false">
                        <padding>
                            <Insets bottom="20" left="20" right="20" top="20" />
                        </padding>

                        <ProgressBar fx:id="progressBar" maxWidth="1.7976931348623157E308" minHeight="10" prefWidth="300" styleClass="progress-bar" />

                        <Label fx:id="loadingText" styleClass="loading-text" text="Chargement en cours..." />
                    </VBox>

                    <!-- Recent Activity -->
                    <VBox fx:id="homeLayout" spacing="10" styleClass="section" visible="false">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <FontIcon iconLiteral="fa-history" iconSize="18" styleClass="section-icon" />
                            <Label styleClass="section-title" text="Activité Récente" />
                            <Region HBox.hgrow="ALWAYS" />
                            <Button styleClass="text-button" text="Voir tout" />
                        </HBox>

                        <VBox styleClass="activity-list">
                            <HBox styleClass="activity-item">
                                <FontIcon iconLiteral="fa-shopping-cart" iconSize="20" styleClass="activity-icon" />
                                <VBox styleClass="activity-details">
                                    <Label styleClass="activity-title" text="Nouvelle commande #1256" />
                                    <Label styleClass="activity-time" text="Il y a 2 minutes" />
                                </VBox>
                                <Button styleClass="small-button" text="Voir" />
                            </HBox>
                        </VBox>
                    </VBox>
                    <VBox fx:id="facturationLayout" spacing="10" styleClass="section">
                        <Label styleClass="section-title" text="Système de Facturation" />
                        <HBox prefHeight="100.0" prefWidth="200.0">
                            <children>

                                <!-- Informations client -->
                                <GridPane hgap="10" vgap="5">
                                    <Label text="facture:" GridPane.columnIndex="0" GridPane.rowIndex="0" />

                                    <Label text="Nom:" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                                    <TextField fx:id="nomClientField" text="Client " GridPane.columnIndex="1" GridPane.rowIndex="1" />
                           <Label text="0000/200" GridPane.columnIndex="1" />
                                    <columnConstraints>
                                        <ColumnConstraints />
                                        <ColumnConstraints />
                                    </columnConstraints>
                                    <rowConstraints>
                                        <RowConstraints />
                                        <RowConstraints />
                                    </rowConstraints>
                                </GridPane>
                            </children>
                        </HBox>
                        <HBox spacing="2.0">
                            <children>

                                <!-- Articles/Produits -->
                                <TableView fx:id="articlesTable" styleClass="data-table">
                                    <columns>
                                        <TableColumn fx:id="produitCol" text="Produit" />
                                        <TableColumn fx:id="prixUnitaireCol" text="Prix Unitaire" />
                                        <TableColumn fx:id="quantiteCol" text="Quantité" />
                                        <TableColumn fx:id="totalCol" text="Total" />
                                    </columns>
                                </TableView>
                                <VBox spacing="5.0">
                                    <children>
                                        <HBox>
                                            <children>
                                                <TextField promptText="Recherche" />
                                                <FontIcon iconLiteral="fa-search" iconSize="16" />
                                            </children>
                                        </HBox>
                                        <ComboBox fx:id="produitComboBox" prefHeight="23.0" prefWidth="105.0" promptText="Sélectionner un produit" />
                                        <Button styleClass="action-button" text="Ajouter" />
                                    </children>
                                </VBox>
                        <Label text="Description">
                           <font>
                              <Font name="System Bold" size="24.0" />
                           </font>
                        </Label>
                            </children>
                        </HBox>

                        <!-- Ajout d'articles -->
                        <HBox alignment="CENTER_LEFT" spacing="10" />
                        <TableView fx:id="articlesTable1" prefHeight="134.0" prefWidth="250.0" styleClass="data-table">
                            <columns>
                                <TableColumn fx:id="produitCol1" text="Produit" />
                                <TableColumn fx:id="prixUnitaireCol1" text="Prix Unitaire" />
                                <TableColumn fx:id="quantiteCol1" text="Quantité" />
                                <TableColumn fx:id="totalCol1" text="Total" />
                            </columns>
                        </TableView>

                        <!-- Total et validation -->
                        <HBox alignment="CENTER_RIGHT" spacing="20">
                            <Label styleClass="total-label" text="Total:" />
                            <Label fx:id="totalFactureLabel" styleClass="total-amount" text="0.00" />
                        </HBox>

                        <HBox alignment="CENTER_RIGHT" spacing="10">
                            <Button styleClass="primary-button" text="Générer Facture" />
                            <Button styleClass="secondary-button" text="Annuler" />
                        </HBox>
                    </VBox>

<!--                    <VBox fx:id="produitLayout" spacing="10" styleClass="section" visible="false" />-->
                    <VBox fx:id="produitLayout" spacing="20" styleClass="section" visible="false">
                        <padding>
                            <Insets top="20" right="20" bottom="20" left="20"/>
                        </padding>

                        <!-- Titre de la section -->
                        <Label text="Gestion des Produits" styleClass="section-title"/>

                        <!-- Barre d'outils -->
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Button text="Ajouter Produit" styleClass="btn-primary">
                                <graphic>
                                    <FontIcon iconLiteral="fa-plus-circle" iconSize="16"/>
                                </graphic>
                            </Button>
                            <Button text="Modifier Produit" styleClass="btn-primary">
                                <graphic>
                                    <FontIcon iconLiteral="fa-pencil" iconSize="16"/>
                                </graphic>
                            </Button>
                            <Button text="Supprimer Sélection" styleClass="btn-danger">
                                <graphic>
                                    <FontIcon iconLiteral="fa-minus-circle" iconSize="16"/>
                                </graphic>
                            </Button>
                            <Button text="Tout Supprimer" styleClass="btn-danger">
                                <graphic>
                                    <FontIcon iconLiteral="fa-trash" iconSize="16"/>
                                </graphic>
                            </Button>
                        </HBox>

                        <!-- Tableau des produits -->
                        <TableView fx:id="produitTable" styleClass="modern-table">
                            <columns>
                                <TableColumn fx:id="idCol" text="ID" styleClass="table-header"/>
                                <TableColumn fx:id="nomCol" text="Nom" styleClass="table-header"/>
                                <TableColumn fx:id="prixCol" text="Prix" styleClass="table-header"/>
                                <TableColumn fx:id="quantitCol" text="Quantité" styleClass="table-header"/>
                                <TableColumn fx:id="categorieCol" text="Catégorie" styleClass="table-header"/>
                                <TableColumn fx:id="actionsCol" text="Actions" styleClass="table-header"/>

                            </columns>
                            <columnResizePolicy>
                                <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                            </columnResizePolicy>
                        </TableView>

                        <!-- Formulaire d'ajout/modification -->
                        <GridPane hgap="10" vgap="10" visible="false" fx:id="produitForm">
                            <padding>
                                <Insets top="10" right="10" bottom="10" left="10"/>
                            </padding>

                            <Label text="Nom:" GridPane.rowIndex="0" GridPane.columnIndex="0" styleClass="form-label"/>
                            <TextField fx:id="nomField" GridPane.rowIndex="0" GridPane.columnIndex="1" GridPane.columnSpan="2"/>

                            <Label text="Prix:" GridPane.rowIndex="1" GridPane.columnIndex="0" styleClass="form-label"/>
                            <TextField fx:id="prixField" GridPane.rowIndex="1" GridPane.columnIndex="1"/>

                            <Label text="Quantité:" GridPane.rowIndex="2" GridPane.columnIndex="0" styleClass="form-label"/>
                            <TextField fx:id="quantiteField" GridPane.rowIndex="2" GridPane.columnIndex="1"/>

                            <Label text="Catégorie:" GridPane.rowIndex="3" GridPane.columnIndex="0" styleClass="form-label"/>
                            <ComboBox fx:id="categorieCombo" GridPane.rowIndex="3" GridPane.columnIndex="1" GridPane.columnSpan="2"/>

                            <HBox spacing="10" GridPane.rowIndex="4" GridPane.columnIndex="1" GridPane.columnSpan="2">
                                <Button text="Enregistrer" styleClass="btn-success">
                                    <graphic>
                                        <FontIcon iconLiteral="fa-floppy-o" iconSize="16"/>
                                    </graphic>
                                </Button>
                                <Button text="Annuler" styleClass="btn-secondary">
                                    <graphic>
                                        <FontIcon iconLiteral="fa-close" iconSize="16"/>
                                    </graphic>
                                </Button>
                            </HBox>
                        </GridPane>

                        <!-- Aperçu du produit -->
                        <VBox fx:id="produitPreview" spacing="10" styleClass="preview-box" visible="false">
                            <padding>
                                <Insets top="15" right="15" bottom="15" left="15"/>
                            </padding>

                            <Label text="Aperçu du Produit" styleClass="preview-title"/>
                            <HBox spacing="20">
                                <VBox spacing="5">
                                    <Label text="Nom:" styleClass="preview-label"/>
                                    <Label fx:id="previewNom" styleClass="preview-value"/>

                                    <Label text="Prix:" styleClass="preview-label"/>
                                    <Label fx:id="previewPrix" styleClass="preview-value"/>
                                </VBox>
                                <VBox spacing="5">
                                    <Label text="Quantité:" styleClass="preview-label"/>
                                    <Label fx:id="previewQuantite" styleClass="preview-value"/>

                                    <Label text="Catégorie:" styleClass="preview-label"/>
                                    <Label fx:id="previewCategorie" styleClass="preview-value"/>
                                </VBox>
                            </HBox>
                            <Button text="Fermer" styleClass="btn-secondary" >
                                <graphic>
                                    <FontIcon iconLiteral="fa-window-close" iconSize="16"/>
                                </graphic>
                            </Button>
                        </VBox>
                    </VBox>
                    <VBox fx:id="depenseLayout" spacing="10" styleClass="section" visible="false" />
                    <VBox fx:id="clotureLayout" spacing="10" styleClass="section" visible="false" />
                    <VBox fx:id="parametreLayout" spacing="10" styleClass="section" visible="false" />
                </children>
            </StackPane>
        </VBox>
    </center>
</BorderPane>
